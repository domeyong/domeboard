<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8" />
    <title>DomeBoard - ë§ˆì¸ë“œì‰ì–´ ì¡°íšŒê¸°</title>
    <style>
        body {
            background-color: #121212;
            color: #f0f0f0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 40px;
            max-width: 800px;
            margin: auto;
        }

        h1 {
            text-align: center;
            margin-bottom: 10px;
            font-weight: 700;
            color: #64b5f6;
        }

        p.description {
            text-align: center;
            margin-bottom: 30px;
            color: #bbb;
        }

        input[type="text"] {
            width: 100%;
            padding: 14px;
            font-size: 1rem;
            border: none;
            border-radius: 8px;
            background-color: #222;
            color: #eee;
        }

        button {
            width: 100%;
            margin-top: 16px;
            padding: 14px;
            font-size: 1.1rem;
            background-color: #64b5f6;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            color: #121212;
            font-weight: 700;
            transition: background-color 0.3s ease;
        }

        button:hover {
            background-color: #42a5f5;
        }

        #result {
            margin-top: 40px;
        }

        .profile {
            background-color: #1d1d1d;
            padding: 24px;
            border-radius: 12px;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .profile img {
            width: 100px;
            height: 100px;
            border-radius: 50%;
        }

        .profile-info p {
            margin: 4px 0;
        }

        .topic-result {
            background-color: #222;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 24px;
        }

        .topic-result h3 {
            color: #81d4fa;
            margin-bottom: 12px;
        }

        .error-msg {
            color: #ff7961;
            font-weight: 600;
        }
    </style>
</head>

<body>
    <h1>DomeBoard</h1>
    <p class="description">ë„ë¯¸ë³´ë“œ ë§ˆì¸ë“œì‰ì–´ ì¡°íšŒê¸°<br>ì½œIDë¥¼ ì…ë ¥í•˜ê³  ë„ë¯¸ë³´ë“œ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.</p>
    <input id="kolIdInput" placeholder="ex. 12345714467480694787" type="text" />
    <button id="searchBtn" onclick="searchMindshare()">ë„ë¯¸ë³´ë“œ ì¡°íšŒ</button>
    <div id="result"></div>

    <script>
        const topics = ["UXLINK", "MIRA", "NEWTON", "MONAD", "HANAHANA", "THEORIQ", "OPENLEDGER", "MITOSIS", "PORTALPORTAL", "SYMPHONY", "MNT", "HUMANITY", "BOOPBOOPFUN", "GOATNETWORK", "KAITO"];

        async function fetchMindshare(kolId, topic, duration) {
            const url = "https://hub.kaito.ai/api/v1/gateway/ai";
            const headers = { "Content-Type": "application/json" };
            const body = JSON.stringify({
                path: "/api/yapper/public_kol_mindshare",
                method: "GET",
                params: {
                    kol: kolId,
                    type: "kol",
                    duration: duration,
                    customized_community: "customized",
                    community_yaps: true,
                    topic_id: topic
                },
                body: {}
            });

            try {
                const response = await fetch(url, {
                    method: "POST",
                    headers,
                    body
                });

                if (!response.ok) return { error: `API ì˜¤ë¥˜: ${response.status}` };

                const data = await response.json();
                const result = data.resultWithKol?.[0];
                if (!result) return { error: `${topic} ë°ì´í„° ì—†ìŒ` };

                return {
                    mindshare: result[`last_${duration}_mindshare`] ?? null,
                    rank: result.rank ?? null
                };
            } catch (e) {
                return { error: e.message };
            }
        }

        async function fetchProfile(kolId) {
            const url = "https://hub.kaito.ai/api/v1/gateway/ai";
            const headers = { "Content-Type": "application/json" };
            const body = JSON.stringify({
                path: "/api/yapper/public_kol_mindshare",
                method: "GET",
                params: {
                    kol: kolId,
                    type: "kol",
                    duration: "30d",
                    customized_community: "customized",
                    community_yaps: true,
                    topic_id: "KAITO"
                },
                body: {}
            });

            try {
                const res = await fetch(url, {
                    method: "POST",
                    headers,
                    body
                });
                const json = await res.json();
                const info = json.resultWithKol?.[0];
                if (!info) return null;

                return {
                    icon: info.icon,
                    name: info.name,
                    username: info.username,
                    followers: info.follower_count
                };
            } catch {
                return null;
            }
        }

        async function searchMindshare() {
            const kolId = document.getElementById("kolIdInput").value.trim();
            const resultDiv = document.getElementById("result");
            const button = document.getElementById("searchBtn");
            const originalText = button.innerText;

            if (!kolId) {
                resultDiv.innerHTML = '<p class="error-msg">ì½œIDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>';
                return;
            }

            button.innerText = "ì¡°íšŒ ì¤‘...";
            button.disabled = true;
            resultDiv.innerHTML = "";

            let html = "";

            const profile = await fetchProfile(kolId);

            if (profile) {
                html += `
            <div class="profile">
                <img src="${profile.icon}" />
                <div class="profile-info">
                    <p><strong>@${profile.username}</strong> (${profile.name})</p>
                    <p>íŒ”ë¡œì›Œ: ${profile.followers.toLocaleString()}ëª…</p>
                    <p style="margin-top: 6px; color: #aaa; font-size: 0.95rem;">
                        ğŸ”— <a href="https://x.com/${profile.username}" target="_blank" style="color: #81d4fa; text-decoration: none;">X í”„ë¡œí•„</a>
                    </p>
                </div>
            </div>`;
            } else {
                html += `<p class="error-msg">ğŸ˜¢ í”„ë¡œí•„ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>`;
            }

            for (const topic of topics) {
                const res7 = await fetchMindshare(kolId, topic, "7d");
                const res30 = await fetchMindshare(kolId, topic, "30d");

                if (res7.error || res30.error) {
                    html += `<div class="topic-result"><h3>${topic} í”„ë¡œì íŠ¸</h3><p class="error-msg">${res7.error || res30.error}</p></div>`;
                } else {
                    const m7 = res7.mindshare?.toFixed(8) ?? "N/A";
                    const r7 = res7.rank ?? "N/A";
                    const m30 = res30.mindshare?.toFixed(8) ?? "N/A";
                    const r30 = res30.rank ?? "N/A";

                    html += `
                <div class="topic-result">
                    <h3>${topic} í”„ë¡œì íŠ¸</h3>
                    <p>ìµœê·¼ 7ì¼ ë§ˆì¸ë“œì‰ì–´: ${m7} (ë­í‚¹: ${r7})</p>
                    <p>ìµœê·¼ 30ì¼ ë§ˆì¸ë“œì‰ì–´: ${m30} (ë­í‚¹: ${r30})</p>
                </div>`;
                }
            }

            resultDiv.innerHTML = html;
            button.innerText = originalText;
            button.disabled = false;
        }
    </script>



</body>

</html>
