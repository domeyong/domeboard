<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8" />
    <title>DomeBoard - 마인드쉐어 조회기</title>
    <style>
        body {
            background-color: #121212;
            color: #f0f0f0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 40px;
            max-width: 800px;
            margin: auto;
        }

        h1 {
            text-align: center;
            margin-bottom: 10px;
            font-weight: 700;
            color: #64b5f6;
        }

        p.description {
            text-align: center;
            margin-bottom: 10px;
            color: #bbb;
        }

        input[type="text"],
        select {
            width: 100%;
            padding: 14px;
            font-size: 1rem;
            border: none;
            border-radius: 8px;
            background-color: #222;
            color: #eee;
            margin-top: 12px;
        }

        button {
            width: 100%;
            margin-top: 16px;
            padding: 14px;
            font-size: 1.1rem;
            background-color: #64b5f6;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            color: #121212;
            font-weight: 700;
            position: relative;
            overflow: hidden;
        }

        #progressInsideBtn {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            width: 0%;
            background-color: rgba(255, 255, 255, 0.25);
            z-index: 0;
            transition: width 0.2s ease;
        }

        #searchBtn span {
            position: relative;
            z-index: 1;
        }

        #result {
            margin-top: 40px;
        }

        .profile {
            background-color: #1d1d1d;
            padding: 24px;
            border-radius: 12px;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .profile img {
            width: 100px;
            height: 100px;
            border-radius: 50%;
        }

        .profile-info p {
            margin: 4px 0;
        }

        .topic-result {
            background-color: #222;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 24px;
        }

        .topic-result h3 {
            color: #81d4fa;
            margin-bottom: 12px;
        }

        .error-msg {
            color: #ff7961;
            font-weight: 600;
        }

        .credit {
            text-align: center;
            margin-bottom: 20px;
            font-size: 0.95rem;
        }

        .credit a {
            color: #64b5f6;
            text-decoration: none;
        }
    </style>
</head>

<body>
    <h1>DomeBoard</h1>
    <div class="credit">
        ✨ Made by <a href="https://x.com/domeyong__" target="_blank">@domeyong__</a>
    </div>
    <p class="description">도미보드 마인드쉐어 조회기<br>콜ID를 입력하고 도미보드 버튼을 눌러주세요.</p>
    <input id="kolIdInput" placeholder="ex. 12345714467480694787" type="text" />
    <select id="topicSelect"></select>

    <button id="searchBtn" onclick="searchMindshare()">
        <div id="progressInsideBtn"></div>
        <span>도미보드 조회</span>
    </button>

    <div id="result"></div>

    <script>
        const topics = [
            "UXLINK", "MIRA", "NEWTON", "MONAD", "HANAHANA", "THEORIQ", "INFINEX",
            "OPENLEDGER", "PEAQ", "MITOSIS", "SKATE", "PORTALPORTAL", "SYMPHONY",
            "MNT", "HUMANITY", "BOOPBOOPFUN", "GOATNETWORK", "KAITO", "SATLAYER"
        ];

        const topicDisplayNames = {
            UXLINK: "UXLINK",
            MIRA: "Mira",
            NEWTON: "Newton",
            MONAD: "Monad",
            HANAHANA: "Hanahana",
            THEORIQ: "Theoriq",
            INFINEX: "Infinex",
            OPENLEDGER: "OpenLedger",
            PEAQ: "Peaq",
            MITOSIS: "Mitosis",
            SKATE: "Skate",
            PORTALPORTAL: "Portal to BTC",
            SYMPHONY: "Symphony",
            MNT: "MNT",
            HUMANITY: "Humanity",
            BOOPBOOPFUN: "BoopBoopFun",
            GOATNETWORK: "GOAT Network",
            KAITO: "Kaito",
            SATLAYER: "Satlayer"
        };

        async function fetchFullMindshare(kolId, topic) {
            const url = `https://hub.kaito.ai/api/v1/gateway/ai/kol/mindshare?kol=${kolId}&type=kol&duration=30d&customized_community=customized&community_yaps=true&topic_id=${topic}`;
            const res = await fetch(url);
            const data = await res.json();
            return data.resultWithKol?.[0] || null;
        }

        async function fetchProfile(kolId) {
            const url = `https://hub.kaito.ai/api/v1/gateway/ai/kol/mindshare?kol=${kolId}&type=kol&duration=30d&customized_community=customized&community_yaps=true&topic_id=KAITO`;
            try {
                const res = await fetch(url);
                if (!res.ok) return null;
                const json = await res.json();
                const info = json.resultWithKol?.[0];
                return info || null;
            } catch {
                return null;
            }
        }

        function formatDelta(value) {
            if (value === undefined || value === null) return "";
            const delta = (value * 100).toFixed(6);
            if (value > 0) return `<span style='color:#4caf50'>▲${delta}%</span>`;
            if (value < 0) return `<span style='color:#f44336'>▼${Math.abs(delta)}%</span>`;
            return `<span style='color:#aaa'>-</span>`;
        }

        async function searchMindshare() {
            const kolId = document.getElementById("kolIdInput").value.trim();
            const selectedTopic = document.getElementById("topicSelect").value;
            const resultDiv = document.getElementById("result");
            const button = document.getElementById("searchBtn");
            const btnText = button.querySelector("span");
            const progressBar = document.getElementById("progressInsideBtn");

            if (!kolId) {
                resultDiv.innerHTML = '<p class="error-msg">콜ID를 입력해주세요.</p>';
                return;
            }

            btnText.innerText = "조회 중...";
            button.disabled = true;
            progressBar.style.width = "30%";
            resultDiv.innerHTML = "";

            const profile = await fetchProfile(kolId);
            let html = "";

            if (profile) {
                html += `
                    <div class="profile">
                        <img src="${profile.icon}" />
                        <div class="profile-info">
                            <p><strong>@${profile.username}</strong> (${profile.name})</p>
                            <p>팔로잉: ${profile.following_count.toLocaleString()}명 | 팔로워: ${profile.follower_count.toLocaleString()}명</p>
                            <p>스마트팔로워: ${profile.smart_follower_count.toLocaleString()}명</p>
                            <p style="margin-top: 6px; color: #aaa; font-size: 0.95rem;">
                                🔗 <a href="https://x.com/${profile.username}" target="_blank" style="color: #81d4fa; text-decoration: none;">X 프로필</a>
                            </p>
                        </div>
                    </div>`;
            }

            progressBar.style.width = "60%";

            const data = await fetchFullMindshare(kolId, selectedTopic);

            if (!data) {
                html += `<p class="error-msg">❌ ${topicDisplayNames[selectedTopic]} 데이터 없음</p>`;
            } else {
                const name = topicDisplayNames[selectedTopic];
                const m7 = (data.last_7d_mindshare * 100).toFixed(6) + "%";
                const m30 = (data.last_30d_mindshare * 100).toFixed(6) + "%";
                const m12 = (data.last_12m_mindshare * 100).toFixed(6) + "%";
                const d7 = formatDelta(data.change_7d);
                const d30 = formatDelta(data.change_30d);
                const d12 = formatDelta(data.change_12m);

                html += `
                    <div class="topic-result">
                        <h3>${name}</h3>
                        <p>최근 7일 마인드쉐어: ${m7} ${d7}</p>
                        <p>최근 30일 마인드쉐어: ${m30} ${d30}</p>
                        <p>최근 1년 마인드쉐어: ${m12} ${d12}</p>
                    </div>`;
            }

            btnText.innerText = "✅ 완료";
            progressBar.style.width = "100%";
            setTimeout(() => {
                progressBar.style.width = "0%";
                btnText.innerText = "도미보드 조회";
                button.disabled = false;
            }, 1200);

            resultDiv.innerHTML = html;
        }

        // 드롭다운 초기화
        const selectEl = document.getElementById("topicSelect");
        topics.forEach(t => {
            const option = document.createElement("option");
            option.value = t;
            option.text = topicDisplayNames[t];
            selectEl.appendChild(option);
        });
    </script>
</body>

</html>
