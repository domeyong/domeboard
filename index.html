<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8" />
    <title>DomeBoard - ë§ˆì¸ë“œì‰ì–´ ì¡°íšŒê¸°</title>
    <style>
        body {
            background-color: #121212;
            color: #f0f0f0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 40px;
            max-width: 800px;
            margin: auto;
        }

        h1 {
            text-align: center;
            margin-bottom: 10px;
            font-weight: 700;
            color: #64b5f6;
        }

        p.description {
            text-align: center;
            margin-bottom: 10px;
            color: #bbb;
        }

        input[type="text"],
        select {
            width: 100%;
            padding: 14px;
            font-size: 1rem;
            border: none;
            border-radius: 8px;
            background-color: #222;
            color: #eee;
            margin-top: 12px;
        }

        #topicSelect {
            display: none;
        }

        button {
            width: 100%;
            margin-top: 16px;
            padding: 14px;
            font-size: 1.1rem;
            background-color: #64b5f6;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            color: #121212;
            font-weight: 700;
            position: relative;
            overflow: hidden;
        }

        #progressInsideBtn {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            width: 0%;
            background-color: rgba(255, 255, 255, 0.25);
            z-index: 0;
            transition: width 0.2s ease;
        }

        #searchBtn span {
            position: relative;
            z-index: 1;
        }

        #result {
            margin-top: 40px;
        }

        .profile {
            background-color: #1d1d1d;
            padding: 24px;
            border-radius: 12px;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .profile img {
            width: 100px;
            height: 100px;
            border-radius: 50%;
        }

        .profile-info p {
            margin: 4px 0;
        }

        .topic-result {
            background-color: #222;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 24px;
        }

        .topic-result h3 {
            color: #81d4fa;
            margin-bottom: 12px;
        }

        .error-msg {
            color: #ff7961;
            font-weight: 600;
        }

        .credit {
            text-align: center;
            margin-bottom: 20px;
            font-size: 0.95rem;
        }

        .credit a {
            color: #64b5f6;
            text-decoration: none;
        }
    </style>
</head>

<body>
    <h1>DomeBoard</h1>
    <div class="credit">
        âœ¨ Made by <a href="https://x.com/domeyong__" target="_blank">@domeyong__</a>
    </div>
    <p class="description">
        ë„ë¯¸ë³´ë“œ ë§ˆì¸ë“œì‰ì–´ ì¡°íšŒê¸°<br>
        ì½œIDë¥¼ ì…ë ¥í•˜ê³  ë„ë¯¸ë³´ë“œ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.<br><br>
        â€¢ í”„ë¡œì íŠ¸ ì°¸ì—¬ê¸°ë¡ì´ ì—†ìœ¼ë©´ ë§ˆì¸ë“œì‰ì–´ 100ìœ„ ê°’ì´ ì¶œë ¥ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.<br>
        â€¢ 100ìœ„ ê°’ì„ êµ¬í•˜ê¸° ìœ„í•´ ë¡œë”© ì†ë„ê°€ ë‹¤ì†Œ ëŠë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    </p>
    <input id="kolIdInput" placeholder="ex. 12345714467480694787" type="text" />
    <select id="topicSelect"></select>

    <button id="searchBtn" onclick="handleKolIdInput()">
        <div id="progressInsideBtn"></div>
        <span>ë„ë¯¸ë³´ë“œ ì¡°íšŒ</span>
    </button>

    <div id="result"></div>

    <script>
        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
        const topics = [
            "UXLINK", "MIRA", "NEWTON", "MONAD", "HANAHANA", "THEORIQ", "INFINEX",
            "OPENLEDGER", "PEAQ", "MITOSIS", "SKATE", "PORTALPORTAL", "SYMPHONY",
            "MNT", "HUMANITY", "BOOPBOOPFUN", "GOATNETWORK", "KAITO", "SATLAYER",
            "DYDX", "BLS"
        ];

        const topicDisplayNames = {
            UXLINK: "UXLINK", MIRA: "Mira", NEWTON: "Newton", MONAD: "Monad", HANAHANA: "Hanahana",
            THEORIQ: "Theoriq", INFINEX: "Infinex", OPENLEDGER: "OpenLedger", PEAQ: "Peaq", MITOSIS: "Mitosis",
            SKATE: "Skate", PORTALPORTAL: "Portal to BTC", SYMPHONY: "Symphony", MNT: "MNT",
            HUMANITY: "Humanity", BOOPBOOPFUN: "BoopBoopFun", GOATNETWORK: "GOAT Network",
            KAITO: "Kaito", SATLAYER: "Satlayer", DYDX: "dYdX", BLS: "Bless"
        };

        let currentKolId = null;

        async function fetchMindshareByDuration(kolId, topic, duration) {
            const url = `https://hub.kaito.ai/api/v1/gateway/ai/kol/mindshare?kol=${kolId}&type=kol&duration=${duration}&customized_community=customized&community_yaps=true&topic_id=${topic}&_=${Date.now()}`;
            try {
                const res = await fetch(url);
                const json = await res.json();

                return json.resultWithKol?.[0] || null;
            } catch (err) {

                return null;
            }
        }

        async function fetchProfile(kolId) {
            const url = `https://hub.kaito.ai/api/v1/gateway/ai/kol/mindshare?kol=${kolId}&type=kol&duration=30d&customized_community=customized&community_yaps=true&topic_id=KAITO`;
            try {
                const res = await fetch(url);
                const json = await res.json();

                return json.resultWithKol?.[0] || null;
            } catch (err) {
                console.error("[âŒ fetchProfile] ì‹¤íŒ¨:", err);
                return null;
            }
        }

        async function fetchRank100Data(topic, duration) {
            const url = `https://hub.kaito.ai/api/v1/gateway/ai/kol/mindshare?type=heatmap&duration=${duration}&sort_type=desc&top_n=100&customized_community=customized&community_yaps=true&topic_id=${topic}`;
            try {
                const res = await fetch(url);
                const json = await res.json();

                const data = json.resultWithKol;
                if (!data || !Array.isArray(data)) return null;
                return data.find(user => user.rank === 100) || data[data.length - 1] || null;
            } catch (err) {
                console.error(`[âŒ fetchRank100Data] ${topic} ${duration} ì‹¤íŒ¨:`, err);
                return null;
            }
        }

        function formatPercentage(v) {
            return v != null ? (v * 100).toFixed(6) + "%" : "N/A";
        }

        function formatDelta(value) {
            if (value === undefined || value === null) return "";
            const delta = (value * 100).toFixed(6);
            if (value > 0) return `<span style='color:#4caf50'>â–²${delta}%</span>`;
            if (value < 0) return `<span style='color:#f44336'>â–¼${Math.abs(delta)}%</span>`;
            return `<span style='color:#aaa'>-</span>`;
        }

        function formatRank(v) {
            return v !== null && v !== undefined && v !== "NA" ? `#${v}` : "N/A";
        }

        async function handleKolIdInput() {
            const kolId = document.getElementById("kolIdInput").value.trim();
            const profileDiv = document.getElementById("result");
            const dropdown = document.getElementById("topicSelect");
            const progressBar = document.getElementById("progressInsideBtn");
            const btnText = document.querySelector("#searchBtn span");



            if (!kolId) {
                profileDiv.innerHTML = `<p class="error-msg">ì½œIDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>`;
                dropdown.style.display = "none";
                return;
            }

            currentKolId = kolId;
            profileDiv.innerHTML = "<p>ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>";
            dropdown.style.display = "none";
            progressBar.style.width = "30%";
            btnText.innerText = "ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...";

            const profile = await fetchProfile(kolId);
            if (profile) {

                profileDiv.innerHTML = `
            <div class="profile">
                <img src="${profile.icon}" />
                <div class="profile-info">
                    <p><strong>@${profile.username}</strong> (${profile.name})</p>
                    <p>íŒ”ë¡œì‰: ${profile.following_count.toLocaleString()}ëª… | íŒ”ë¡œì›Œ: ${profile.follower_count.toLocaleString()}ëª…</p>
                    <p>ìŠ¤ë§ˆíŠ¸íŒ”ë¡œì›Œ: ${profile.smart_follower_count.toLocaleString()}ëª…</p>
                    <p style="margin-top: 6px; color: #aaa; font-size: 0.95rem;">
                        ğŸ”— <a href="https://x.com/${profile.username}" target="_blank" style="color: #81d4fa; text-decoration: none;">X í”„ë¡œí•„</a>
                    </p>
                </div>
            </div>
            <div id="topicResultBox"></div>
        `;
                dropdown.style.display = "block";
                dropdown.value = "UXLINK";
                await sleep(1500);         // âœ… ì—¬ê¸° ì¶”ê°€!
                await updateMindshare();

            } else {
                console.warn("âŒ í”„ë¡œí•„ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨");
                profileDiv.innerHTML = `<p class="error-msg">âŒ í”„ë¡œí•„ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨</p>`;
            }

            progressBar.style.width = "100%";
            setTimeout(() => {
                progressBar.style.width = "0%";
                btnText.innerText = "ë„ë¯¸ë³´ë“œ ì¡°íšŒ";
            }, 1000);
        }

        const compareBlock = (label, myShare, topShare) => {
            if (typeof myShare !== "number" || typeof topShare !== "number") return "";
            const diff = (topShare - myShare) * 100;
            return `
            <p style="margin-bottom: 4px; color: #ccc;">
                ğŸ§­ ì‹¤ì‹œê°„ 100ìœ„ (${label}): ${(topShare * 100).toFixed(4)}%
            </p>
            <p style="margin-bottom: 10px; color: #aaa;">
                ${diff > 0 ? `ğŸ’¡ 100ìœ„ ì§„ì…ê¹Œì§€ ${diff.toFixed(4)}% â†‘ í•„ìš”!` : `ğŸ‰ ì´ë¯¸ Top 100 ì•ˆì— ìˆì–´ìš”!`}
            </p>`;
        };

        async function updateMindshare() {
            if (!currentKolId) return;

            const topic = document.getElementById("topicSelect").value;
            const box = document.getElementById("topicResultBox");
            const progressBar = document.getElementById("progressInsideBtn");



            box.innerHTML = "<p>ì¡°íšŒ ì¤‘...</p>";
            progressBar.style.width = "30%";

            const res7 = await fetchMindshareByDuration(currentKolId, topic, "7d");

            await sleep(500);  // â† ì—¬ê¸°

            const res30 = await fetchMindshareByDuration(currentKolId, topic, "30d");

            await sleep(500);

            const res12 = await fetchMindshareByDuration(currentKolId, topic, "12m");

            await sleep(500);

            const top100_7d = await fetchRank100Data(topic, "7d");

            await sleep(500);

            const top100_30d = await fetchRank100Data(topic, "30d");



            const m7 = formatPercentage(res7?.last_7d_mindshare);
            const m30 = formatPercentage(res30?.last_30d_mindshare);
            const m12 = formatPercentage(res12?.last_12m_mindshare);

            let comparisonNote = "";
            if (res7?.last_7d_mindshare && top100_7d?.mindshare) {
                comparisonNote += compareBlock("7ì¼", res7.last_7d_mindshare, top100_7d.mindshare);
            } else {
                console.warn("âš ï¸ compareBlock ì‹¤íŒ¨ (7ì¼)");
            }

            if (res30?.last_30d_mindshare && top100_30d?.mindshare) {
                comparisonNote += compareBlock("30ì¼", res30.last_30d_mindshare, top100_30d.mindshare);
            } else {
                console.warn("âš ï¸ compareBlock ì‹¤íŒ¨ (30ì¼)");
            }

            const r7 = formatRank(res7?.rank);
            const r30 = formatRank(res30?.rank);
            const r12 = formatRank(res12?.rank);

            const d7 = formatDelta(res7?.change_7d);
            const d30 = formatDelta(res30?.change_30d);
            const d12 = formatDelta(res12?.change_12m);

            box.innerHTML = `
        <div class="topic-result">
            <h3>${topicDisplayNames[topic]}</h3>
            ${comparisonNote}
            <p>ğŸ“Š ìµœê·¼ 7ì¼ ë§ˆì¸ë“œì‰ì–´: ${m7} ${d7} | ğŸ… ë­í‚¹: ${r7}</p>
            <p>ğŸ“Š ìµœê·¼ 30ì¼ ë§ˆì¸ë“œì‰ì–´: ${m30} ${d30} | ğŸ… ë­í‚¹: ${r30}</p>
            <p>ğŸ“Š ìµœê·¼ 1ë…„ ë§ˆì¸ë“œì‰ì–´: ${m12} ${d12} | ğŸ… ë­í‚¹: ${r12}</p>
        </div>
        `;

            progressBar.style.width = "100%";
            setTimeout(() => {
                progressBar.style.width = "0%";
            }, 800);
        }

        const selectEl = document.getElementById("topicSelect");
        topics.forEach(t => {
            const option = document.createElement("option");
            option.value = t;
            option.text = topicDisplayNames[t];
            selectEl.appendChild(option);
        });

        document.getElementById("topicSelect").addEventListener("change", updateMindshare);
    </script>




</body>

</html>
