<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8" />
    <title>DomeBoard - 마인드쉐어 조회기</title>
    <style>
        body {
            background-color: #121212;
            color: #f0f0f0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 40px;
            max-width: 800px;
            margin: auto;
        }

        h1 {
            text-align: center;
            margin-bottom: 10px;
            font-weight: 700;
            color: #64b5f6;
        }

        p.description {
            text-align: center;
            margin-bottom: 30px;
            color: #bbb;
        }

        input[type="text"] {
            width: 100%;
            padding: 14px;
            font-size: 1rem;
            border: none;
            border-radius: 8px;
            background-color: #222;
            color: #eee;
        }

        button {
            width: 100%;
            margin-top: 16px;
            padding: 14px;
            font-size: 1.1rem;
            background-color: #64b5f6;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            color: #121212;
            font-weight: 700;
            transition: background-color 0.3s ease;
        }

        button:hover {
            background-color: #42a5f5;
        }

        #result {
            margin-top: 40px;
        }

        .profile {
            background-color: #1d1d1d;
            padding: 24px;
            border-radius: 12px;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .profile img {
            width: 100px;
            height: 100px;
            border-radius: 50%;
        }

        .profile-info p {
            margin: 4px 0;
        }

        .topic-result {
            background-color: #222;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 24px;
        }

        .topic-result h3 {
            color: #81d4fa;
            margin-bottom: 12px;
        }

        .error-msg {
            color: #ff7961;
            font-weight: 600;
        }
    </style>
</head>

<body>
    <h1>DomeBoard</h1>
    <p class="description">도미보드 마인드쉐어 조회기<br>콜ID를 입력하고 도미보드 버튼을 눌러주세요.</p>
    <input id="kolIdInput" placeholder="ex. 12345714467480694787" type="text" />
    <button id="searchBtn" onclick="searchMindshare()">도미보드 조회</button>
    <div id="result"></div>

    <script>
        const input = document.getElementById("kolInput");
        const btn = document.getElementById("fetchBtn");
        const result = document.getElementById("result");

        btn.addEventListener("click", async () => {
            const kolId = input.value.trim();
            if (!kolId) return;

            result.innerHTML = "불러오는 중...";

            const [profile, rank7d, rank30d, mindshare7d, mindshare30d] = await Promise.all([
                fetchProfile(kolId),
                fetchRanking(kolId, "7d"),
                fetchRanking(kolId, "30d"),
                fetchMindshare(kolId, "7d"),
                fetchMindshare(kolId, "30d")
            ]);

            if (!profile) {
                result.innerHTML = "😢 프로필 정보를 불러올 수 없습니다.";
                return;
            }

            result.innerHTML = `
      <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px;">
        <img src="${profile.icon}" width="60" height="60" style="border-radius: 50%;" />
        <div>
          <div style="font-size: 1.2rem; font-weight: bold;">${profile.name}</div>
          <div style="color: #aaa">@${profile.username} · 팔로워 ${profile.followers.toLocaleString()}</div>
        </div>
      </div>
      <h2>🧠 마인드쉐어</h2>
      <p><b>7일:</b> ${mindshare7d !== null ? mindshare7d + "%" : "조회 실패"}</p>
      <p><b>30일:</b> ${mindshare30d !== null ? mindshare30d + "%" : "조회 실패"}</p>
      <h2>🏆 랭킹</h2>
      <p><b>7일:</b> ${rank7d !== null ? rank7d + "위" : "조회 실패"}</p>
      <p><b>30일:</b> ${rank30d !== null ? rank30d + "위" : "조회 실패"}</p>
    `;
        });

        async function fetchProfile(kolId) {
            const url = "https://hub.kaito.ai/api/v1/gateway/ai";
            const headers = { "Content-Type": "application/json" };

            const body = JSON.stringify({
                path: "/api/yapper/public_kol_profile",
                method: "GET",
                params: { kol: kolId },
                body: {}
            });

            try {
                const res = await fetch(url, { method: "POST", headers, body });
                const json = await res.json();
                const info = json.result;
                if (!info) return null;

                return {
                    icon: info.icon,
                    name: info.name,
                    username: info.username,
                    followers: info.follower_count
                };
            } catch {
                return null;
            }
        }

        async function fetchMindshare(kolId, duration) {
            const url = "https://hub.kaito.ai/api/v1/gateway/ai";
            const headers = { "Content-Type": "application/json" };

            const body = JSON.stringify({
                path: "/api/yapper/get_public_kol_mindshare",
                method: "GET",
                params: {
                    kol: kolId,
                    type: "kol",
                    duration,
                    customized_community: "KAITO",
                    community_yaps: true,
                    topic_id: "KAITO"
                },
                body: {}
            });

            try {
                const res = await fetch(url, { method: "POST", headers, body });
                const json = await res.json();
                return json.result?.mindshare_percentage ?? null;
            } catch {
                return null;
            }
        }

        async function fetchRanking(kolId, duration) {
            const url = "https://hub.kaito.ai/api/v1/gateway/ai";
            const headers = { "Content-Type": "application/json" };

            const body = JSON.stringify({
                path: "/api/yapper/get_public_kol_mindshare_ranking",
                method: "GET",
                params: {
                    kol: kolId,
                    type: "kol",
                    duration,
                    customized_community: "KAITO",
                    community_yaps: true,
                    topic_id: "KAITO"
                },
                body: {}
            });

            try {
                const res = await fetch(url, { method: "POST", headers, body });
                const json = await res.json();
                return json.result?.ranking ?? null;
            } catch {
                return null;
            }
        }
    </script>

</body>

</html>
